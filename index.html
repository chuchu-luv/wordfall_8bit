<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>í•œì»´íƒ€ì ì‚¬ê³ ë„êµ¬ì–´ ê²Œì„</title>
    <style>
        * { image-rendering: pixelated; }
        
        html,body {
            margin:0; padding:0; height:100%;
            font-family: 'Courier New', 'Consolas', monospace;
            background: #000;
            color: #0f0;
            overflow: hidden;
        }
        
        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,255,0,0.03) 0px, transparent 2px, transparent 4px);
            pointer-events: none; z-index: 9999;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0%, 100% { opacity: 0.95; }
            50% { opacity: 1; }
        }
        
        .wrap { display:flex; flex-direction:column; height:100%; background: #000; }
        
        header, footer { padding:10px 12px; background: #111; border: 3px solid #0f0; }
        header { display:flex; align-items:center; gap:12px; flex-wrap:wrap; border-bottom: none; }
        
        .stat {
            background: #000; padding: 12px 16px; border: 2px solid #0f0; font-size: 16px; 
            color: #0f0; text-shadow: 0 0 5px #0f0; font-weight: bold;
        }
        
        .btn {
            background: #000; border: 3px solid #0f0; color: #0f0; padding: 12px 18px;
            cursor: pointer; font-size: 14px; font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px #0f0; transition: all 0.1s; font-weight: bold;
        }
        .btn:hover { background: #0f0; color: #000; }
        
        .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
        
        #canvas { 
            width:100%; flex:1; display:block; background: #000;
            border-left: 3px solid #0f0; border-right: 3px solid #0f0;
        }
        
        .badge {
            padding: 8px 16px; border: 2px solid #0f0; background: #000;
            font-size: 14px; color: #0f0; text-shadow: 0 0 5px #0f0; font-weight: bold;
        }
        
        footer { 
            display:flex; justify-content:space-between; align-items:center; 
            font-size: 16px; color: #0f0; border-top: 3px solid #0f0; font-weight: bold;
        }
        
        .target { color: #ff0; text-shadow: 0 0 5px #ff0; font-size: 18px; }
        
        .game-over {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #000; padding: 30px; border: 4px solid #f00; text-align: center; 
            z-index: 1000; color: #f00; text-shadow: 0 0 5px #f00;
        }
        
        .game-over .btn { border-color: #f00; color: #f00; text-shadow: 0 0 5px #f00; }
        .game-over .btn:hover { background: #f00; color: #000; }
        
        .paused {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #000; padding: 30px; border: 4px solid #0f0; text-align: center; 
            z-index: 1000; color: #0f0;
        }
        
        .start-popup { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: flex; justify-content: center; 
            align-items: center; z-index: 2000; 
        }
        
        .start-content {
            background: #000; padding: 40px; border: 4px solid #0f0; text-align: center; 
            color: #0f0; max-width: 600px;
        }
        
        .start-btn {
            background: #000; border: 3px solid #0f0; color: #0f0; 
            padding: 15px 30px; cursor: pointer; font-size: 16px; 
            font-family: 'Courier New', monospace; margin-top: 20px;
            text-shadow: 0 0 5px #0f0; font-weight: bold;
        }
        .start-btn:hover { background: #0f0; color: #000; }
        
        h1, h2 { text-shadow: 0 0 10px #0f0; }
        h1 { font-size: 20px; font-weight: bold; }
        h2 { font-size: 18px; margin: 0; font-weight: bold; }
        
        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0.3; }
        }
        
        .blink { animation: blink 1s infinite; }
    </style>
</head>
<body>
    <div class="scanline"></div>
    
    <div class="wrap" style="display:none;" id="gameWrap">
        <div style="text-align: center; padding: 15px 0; background: #000; border: 3px solid #0f0; border-bottom: none;">
            <h1 style="margin: 0;">ì¶”ì–µì˜ í•œì»´íƒ€ì-ì‚¬ê³ ë„êµ¬ì–´ ë²„ì „(1~2ìˆ˜ì¤€)</h1>
        </div>
        
        <header>
            <div class="row">
                <div class="stat">ì ìˆ˜ <span id="score">0</span></div>
                <div class="stat">ë ˆë²¨ <span id="level">1</span></div>
                <div class="stat">ì½¤ë³´ <span id="combo">0</span></div>
                <div class="stat">HP <span id="hp">5</span></div>
            </div>
            <div class="row">
                <button class="btn" id="pauseBtn">ì¼ì‹œì •ì§€</button>
                <button class="btn" id="restartBtn">ì¬ì‹œì‘</button>
                <button class="btn" id="muteBtn">ìŒì†Œê±°</button>
            </div>
        </header>

        <canvas id="canvas"></canvas>

        <footer>
            <div>íƒ€ê²Ÿ: <span id="targetWord" class="target">---</span></div>
            <div class="badge">ì—”í„°ë¥¼ ëˆŒëŸ¬ ì œì¶œ</div>
        </footer>
    </div>

    <div style="position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); z-index: 1000; text-align: center; display:none;" id="inputWrap">
        <input id="hidInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
            placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”"
            style="padding: 18px 30px; font-size: 20px; border: 3px solid #0f0; 
            background: #000; color: #0f0; text-align: center; min-width: 400px;
            font-family: 'Courier New', monospace; outline: none; text-shadow: 0 0 5px #0f0; font-weight: bold;" />
    </div>

    <div id="startPopup" class="start-popup">
        <div class="start-content">
            <h2 style="margin-bottom: 20px;">í•œì»´íƒ€ì ì‚¬ê³ ë„êµ¬ì–´ ê²Œì„ (1~2ìˆ˜ì¤€)</h2>
            <p style="font-size: 14px; line-height: 1.8; margin-bottom: 15px; font-weight: bold;">
                íƒ€ìê²Œì„ìœ¼ë¡œ ì‚¬ê³ ë„êµ¬ì–´ë¥¼ ìµí˜€ë³´ì„¸ìš”!<br>
                ë–¨ì–´ì§€ëŠ” ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”<br>ì—”í„°ë¥¼ ëˆŒëŸ¬ ì œì¶œí•˜ì„¸ìš”<br>20ê°œ ë‹¨ì–´ë§ˆë‹¤ ë ˆë²¨ ì—…!
            </p>
            <button class="start-btn blink" id="startBtn">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

   <audio id="bgm" loop autoplay> 
        <source src="Overboard - The Grey Room _ Golden Palms.mp3" type="audio/mpeg">
    </audio>

    <script>
        // 1. audio ìš”ì†Œë¥¼ idë¥¼ ì´ìš©í•´ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const audio = document.getElementById('bgm');
        
        // 2. volume ì†ì„±ì„ 0.5 (50%)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        // ë³¼ë¥¨ ê°’ì€ 0.0 (ìŒì†Œê±°)ë¶€í„° 1.0 (ìµœëŒ€ ë³¼ë¥¨) ì‚¬ì´ì˜ ê°’ì…ë‹ˆë‹¤.
        if (audio) {
            audio.volume = 0.3;
        }
    </script>
   
    <script>
const WORDS = ["ê°€ëŠ¥","ê°„ê²°ì„±","ê°„ì ‘","ê°ê°","ê°•ë ¥","ê°•ì¡°","ê°œí˜","ê±°ë¶€","ê²€ìƒ‰","ê²¬í•´","ê²°ë¡ ","ê²½ìŸ","ê³ ë ¤","ê³ ì •","ê³µê°œ","ê³µë™","ê³µí†µ","ê³µí‰","ê³¼ì¥","ê³¼ì •","ê´€ë ¨","ê´€ë¦¬","ê´€ì°°","êµ¬ë³„","êµ¬ë¶„","ê¶Œì¥","ê· í˜•","ê·¹ë³µ","ê·¼ê±°","ê¸ì •","ê¸°ëŠ¥","ê¸°ë²•","ê¸°ë³¸","ê¸°ìˆ ","ê¸°ì¤€","ê¸°ì´ˆ","ë‚˜ì—´","ë‚´ë¶€","ë‹¤ì–‘ì„±","ë‹¨ê³„","ë‹¨ì •","ëŒ€ë¹„","ëŒ€ì¡°","ëŒ€ì±…","ëŒ€ì¹­","ëŒ€í‘œ","ë„êµ¬","ë„ë‹¬","ë…ë¦½","ë…ì°½","ë™ë“±","ë™ë ¥","ë™ì˜","ë“±ì¥","ëª¨ë°©","ëª©í‘œ","ë¬´ì‹œ","ë¯¸ë§Œ","ë°€ì ‘","ë°˜ë³µ","ë°œê²¬","ë°œë‹¬","ë°œëª…","ë°œìƒ","ë°œì „","ë°©ì‹","ë°©ì•ˆ","ë°©ì§€","ë°°ê²½","ë°°ì—´","ë²”ìœ„","ë²•ì¹™","ë³€ê²½","ë³€ì²œ","ë³€í™”","ë³´ê´€","ë³´ì•ˆ","ë³´ì™„","ë³´ì¥","ë³´í˜¸","ë³µì‚¬","ë¶€ì •","ë¶„ë¥˜","ë¶„ë¦¬","ë¹„ìœ¨","ë¹„íŒ","ì‚¬ê³ ","ì‚¬ë¡€","ì‚­ì œ","ìƒëŒ€","ìƒìƒ","ìƒíƒœ","ìƒí™©","ìƒëµ","ìƒì‚°","ì„¤ë“","ì„±ê³¼","ì„±ëŠ¥","ì„±ì¥","ì„±ì§ˆ","ì„¸ê¸°","ì†Œê·¹ì ","ì†Œë¹„","ì†Œìœ ","ì†Œì¬","ì†Œí†µ","ìˆ˜ë‹¨","ìˆ˜ë¦½","ìˆ˜ìš©","ìˆ˜ì •","ìˆ˜ì¤€","ìˆ˜ì§‘","ìŠµë“","ì‹œë„","ì‹¤ì‹œ","ì‹¤ì²œ","ì‹¤í–‰","ì‹¤í—˜","ì‹¬ê°ì„±","ì•ˆì •","ì—°êµ¬","ì˜í–¥","ì˜ˆìƒ","ì˜ˆì‹œ","ì˜ˆì™¸","ì˜ˆì •","ì˜ˆì¸¡","ì™„ë²½","ì™„ì„±","ì™„ì „","ì™¸ë¶€","ìš”êµ¬","ìš”ì•½","ìš”ì ","ìš”ì²­","ìš©ë„","ìš°ìˆ˜","ìš´ì˜","ì›ê²©","ì›ì¸","ìœ ì‚¬","ìœ ìš©","ìœ ì˜","ìœ ìµ","ìœ ì§€","ìœ í˜•","ì˜ê²¬","ì˜ë„","ì˜ì˜","ì˜ì¡´","ì˜ì§€","ì´ë™","ì´í•˜","ì¸ì •","ìê·¹","ìë£Œ","ìì£¼","ì‘ë™","ì ê·¹ì„±","ì „ë‹¬","ì ˆì°¨","ì ‘ìˆ˜","ì ‘ì´‰","ì •ë³´","ì •ìƒ","ì •ì§€","ì œë„","ì œì•ˆ","ì¡°ê±´","ì¡°ì‚¬","ì¢…ë£Œ","ì£¼ì˜","ì£¼ì¥","ì£¼ì œ","ì¤€ìˆ˜","ì¤‘ë¦½","ì¤‘ë³µ","ì¤‘ì‹œ","ì¦ê±°","ì¦ëª…","ì§€ì†","ì§€ì‹œ","ì§€ì‹","ì§€ì›","ì§€ì ","ì§€ì ","ì§€ì •","ì§€ì§€","ì§€í‘œ","ì§„ì¶œ","ì§‘ì¤‘","ì°¨ë‹¨","ì°¸ê°€","ì°¸ì—¬","ì°½ì˜","ì°½ì¡°","ì²˜ë¦¬","ì²´í—˜","ì´ˆê³¼","ì´í•©","ì¶”ë¦¬","ì¶”ì¸¡","ì¶œì²˜","ì¶©ëŒ","ì¶©ì¡±","ì¸¡ì •","íƒ€ë‹¹ì„±","íƒ€í˜‘","íƒêµ¬","íƒìƒ‰","í† ëŒ€","í†µê³¼","í†µì¼","í†µì œ","íŠ¹ì„±","íŠ¹ì§•","íŒŒê´´","íŒŒì•…","íŒë‹¨","íŒëª…","íŒë³„","íŒì •","í¸ì˜","í‰ê°€","íê¸°","íì§€","í¬ê¸°","í¬í•¨","í‘œë³¸","í‘œì‹œ","í‘œì¤€","í‘œí˜„","í•„ìˆ˜","í•™ìŠµ","í•´ê²°","í•´ë‹µ","í•´ë‹¹","í•´ë²•","í•´ì„","í•´ì„¤","í•µì‹¬","í–‰ìœ„","í–¥ìƒ","í—ˆê°€","í˜„ì‹¤","í˜„ì¥","í˜‘ë ¥","í˜‘ì˜","í˜‘ì¡°","í˜•íƒœ","í˜¼ë™","í˜¼ë€","í™•ì¸","í™œë™","í™œìš©","íš¨ê³¼"];

let buckets = {2:[], 3:[], 4:[]};
WORDS.forEach(w => {
    const len = [...w].length;
    if(len === 2) buckets[2].push(w);
    else if(len === 3) buckets[3].push(w);
    else if(len === 4) buckets[4].push(w);
});

let state = {
    score:0, level:1, combo:0, maxCombo:0, hp:5, 
    correct:0, total:0, words:[], lastSpawn:0, target:null,
    over:false, paused:false, muted:false, started:false,
    lastWord:'', lastChar:'', charCount:0
};

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const input = document.getElementById('hidInput');
const bgm = document.getElementById('bgm'); 
const els = {
    score: document.getElementById('score'),
    level: document.getElementById('level'),
    combo: document.getElementById('combo'),
    hp: document.getElementById('hp'),
    target: document.getElementById('targetWord'),
    pauseBtn: document.getElementById('pauseBtn'),
    restartBtn: document.getElementById('restartBtn'),
    muteBtn: document.getElementById('muteBtn'),
    startBtn: document.getElementById('startBtn'),
    startPopup: document.getElementById('startPopup'),
    gameWrap: document.getElementById('gameWrap'),
    inputWrap: document.getElementById('inputWrap')
};

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function beep(freq, dur) {
    if(state.muted) return;
    try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + dur);
    } catch(e) {}
}

function getConfig(lv) {
    const cfgs = {
        1: {speed:8, interval:2.5, max:2},
        2: {speed:12, interval:2.0, max:3},
        3: {speed:16, interval:1.7, max:4},
        4: {speed:20, interval:1.4, max:5}
    };
    return cfgs[lv] || {speed:20+2*(lv-4), interval:0.8, max:5};
}

function pickWord() {
    if(state.level === 1 && buckets[2].length) {
        return buckets[2][Math.floor(Math.random()*buckets[2].length)];
    }
    const mix = state.level===1 ? [1,0,0] : state.level===2 ? [0.6,0.4,0] : [0.3,0.5,0.2];
    const r = Math.random();
    let size = r < mix[0] ? 2 : (r < mix[0]+mix[1] ? 3 : 4);
    if(!buckets[size].length) size = 2;
    const bkt = buckets[size];
    let w, tries = 0;
    do {
        w = bkt[Math.floor(Math.random()*bkt.length)];
        tries++;
    } while(tries<10 && (w===state.lastWord || (w[0]===state.lastChar && state.charCount>=2)));
    if(w[0]===state.lastChar) state.charCount++; 
    else { state.charCount=1; state.lastChar=w[0]; }
    state.lastWord = w;
    return w;
}

class Word {
    constructor(txt) {
        this.text = txt;
        this.size = 24;
        this.font = `bold ${this.size}px 'Courier New', monospace`;
        ctx.font = this.font;
        this.width = ctx.measureText(txt).width;
        this.x = Math.random()*(canvas.width - this.width);
        this.y = -this.size;
        this.speed = getConfig(state.level).speed;
        this.age = 0;
        this.isTarget = false;
        this.birth = Date.now();
        
        // ğŸ¯ ì ë©¸ íš¨ê³¼ë¥¼ ìœ„í•œ ë³€ìˆ˜
        this.isFlickering = false;
        this.flickerTime = 0; 
    }
    update(dt) {
        if (!this.isFlickering) { // ì ë©¸ ì¤‘ì—ëŠ” ì›€ì§ì´ì§€ ì•ŠìŒ
            this.age += dt/1000;
            this.speed = getConfig(state.level).speed * (1 + 0.12*this.age);
            this.y += (this.speed/100) * window.innerHeight * (dt/1000);
        } else {
            this.flickerTime += dt;
        }
    }
    draw() {
        // ğŸ¯ ì ë©¸ ë¡œì§
        if (this.isFlickering) {
            // 50ms ë§ˆë‹¤ ê¹œë¹¡ì„ (200ms ë™ì•ˆ 4ë²ˆ ê¹œë¹¡ì´ê³  ì‚¬ë¼ì§)
            if (Math.floor(this.flickerTime / 50) % 2 === 0) {
                return; // ê¹œë¹¡ì„ ìˆœê°„ì—ëŠ” ê·¸ë¦¬ì§€ ì•ŠìŒ
            }
        }
        
        ctx.font = this.font;
        let clr = this.isTarget ? '#ff0' : '#0f0';
        if(this.y > canvas.height*0.85) clr = '#f00';
        
        // ì ë©¸ ì¤‘ì¼ ë•ŒëŠ” ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰(íƒ€ê²© íš¨ê³¼)ìœ¼ë¡œ ê³ ì •í•©ë‹ˆë‹¤.
        if (this.isFlickering) {
            clr = '#f00';
        }
        
        ctx.fillStyle = clr;
        ctx.shadowBlur = 10;
        ctx.shadowColor = clr;
        ctx.fillText(this.text, this.x, this.y);
        ctx.shadowBlur = 0;
        if(this.isTarget && !this.isFlickering) { 
            ctx.strokeStyle = clr;
            ctx.lineWidth = 2;
            ctx.strokeRect(this.x-5, this.y-this.size-5, this.width+10, this.size+10);
        }
    }
    atBottom() { return this.y > canvas.height*0.9; }
}

function spawn() {
    const cfg = getConfig(state.level);
    const now = Date.now();
    // ì ë©¸ ì¤‘ì¸ ë‹¨ì–´ëŠ” ìµœëŒ€ ë‹¨ì–´ ìˆ˜ ê³„ì‚°ì—ì„œ ì œì™¸
    const activeWords = state.words.filter(w => !w.isFlickering);
    
    if(activeWords.length < cfg.max && now - state.lastSpawn > cfg.interval*1000) {
        const txt = pickWord();
        if(txt) {
            state.words.push(new Word(txt));
            state.lastSpawn = now;
            updateTarget();
        }
    }
}

function updateTarget() {
    state.words.forEach(w => w.isTarget = false);
    // ì ë©¸ ì¤‘ì¸ ë‹¨ì–´ëŠ” íƒ€ê²Ÿì—ì„œ ì œì™¸
    const activeWords = state.words.filter(w => !w.isFlickering);
    
    if(activeWords.length) {
        let bot = activeWords[0];
        activeWords.forEach(w => { if(w.y > bot.y) bot = w; });
        bot.isTarget = true;
        state.target = bot;
        els.target.textContent = bot.text;
    } else {
        state.target = null;
        els.target.textContent = '---';
    }
}

function complete(word) {
    const time = (Date.now() - word.birth)/1000;
    const pts = Math.round((10 + 2*word.text.length) * (1 + state.combo*0.02));
    state.score += pts;
    state.combo++;
    if(state.combo > state.maxCombo) state.maxCombo = state.combo;
    state.correct++;
    beep(880, 0.05);
    
    // ğŸ¯ ë‹¨ì–´ë¥¼ ë°”ë¡œ ì œê±°í•˜ì§€ ì•Šê³  ì ë©¸ ìƒíƒœë¡œ ì „í™˜
    word.isFlickering = true;
    word.isTarget = false;
    
    // ë‹¤ìŒ ë‹¨ì–´ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì§€ì • (ì ë©¸ ì¤‘ì¸ ë‹¨ì–´ëŠ” ì œì™¸)
    updateTarget(); 

    const nl = Math.floor(state.correct/20) + 1;
    if(nl > state.level) state.level = nl;
    updateUI();
}

function miss() {
    state.combo = 0;
    state.hp--;
    beep(110, 0.15);
    if(state.hp <= 0) {
        gameOver();
        bgm.pause();
    }
    updateUI();
}

function gameOver() {
    state.over = true;
    const d = document.createElement('div');
    d.className = 'game-over';
    d.innerHTML = `<h2>ê²Œì„ ì˜¤ë²„!</h2><p>ì ìˆ˜: ${state.score}</p><p>ìµœëŒ€ ì½¤ë³´: ${state.maxCombo}</p><button class="btn" onclick="location.reload()">ì¬ì‹œì‘</button>`;
    document.body.appendChild(d);
}

function handleEnter() {
    const txt = input.value.trim();
    if(!txt) return;
    state.total++;
    
    // ì ë©¸ ì¤‘ì¸ ë‹¨ì–´ëŠ” íƒ€ê²Ÿì—ì„œ ì œì™¸
    const activeWords = state.words.filter(w => !w.isFlickering);
    
    if(state.target && txt === state.target.text && !state.target.isFlickering) {
        complete(state.target);
        input.value = '';
        return;
    }
    for(const w of activeWords) {
        if(txt === w.text) {
            complete(w);
            input.value = '';
            return;
        }
    }
    state.combo = 0;
    beep(110, 0.15);
    input.value = '';
    updateUI();
}

function updateUI() {
    els.score.textContent = state.score;
    els.level.textContent = state.level;
    els.combo.textContent = state.combo;
    els.hp.textContent = state.hp;
}

let last = 0;
function loop(t) {
    if(!last) { last = t; requestAnimationFrame(loop); return; }
    const dt = Math.min(t - last, 100);
    last = t;
    
    if(!state.over && !state.paused && state.started) {
        if(canvas.width !== canvas.offsetWidth || canvas.height !== canvas.offsetHeight) {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const line = canvas.height * 0.9;
        ctx.strokeStyle = '#f00';
        ctx.lineWidth = 3;
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#f00';
        ctx.beginPath();
        ctx.moveTo(0, line);
        ctx.lineTo(canvas.width, line);
        ctx.stroke();
        ctx.shadowBlur = 0;
        
        spawn();
        for(let i = state.words.length-1; i >= 0; i--) {
            const w = state.words[i];
            
            // ğŸ¯ ì ë©¸ ì‹œê°„ì´ 200msë¥¼ ì´ˆê³¼í•˜ë©´ ë‹¨ì–´ë¥¼ ë°°ì—´ì—ì„œ ì œê±°
            if (w.isFlickering && w.flickerTime > 200) {
                 state.words.splice(i, 1);
                 updateTarget();
                 continue; // ì´ ë‹¨ì–´ëŠ” ì—…ë°ì´íŠ¸/ê·¸ë¦¬ê¸° ê±´ë„ˆëœ€
            }
            
            w.update(dt);
            w.draw();
            
            if(w.atBottom()) {
                state.words.splice(i, 1);
                miss();
                updateTarget();
            }
        }
    }
    requestAnimationFrame(loop);
}

function startGame() {
    els.startPopup.style.display = 'none';
    els.gameWrap.style.display = 'flex';
    els.inputWrap.style.display = 'block';
    state.started = true;
    input.focus();
    // ğŸµ ë°°ê²½ìŒì•… ì¬ìƒ ë¡œì§
    if(!state.muted) {
        bgm.play().catch(e => {
            console.log("Background music autoplay blocked, manually playing on interaction.");
        });
    }
}

function pause() {
    state.paused = !state.paused;
    els.pauseBtn.textContent = state.paused ? 'ì¬ê°œ' : 'ì¼ì‹œì •ì§€';
    if(state.paused) {
        const d = document.createElement('div');
        d.className = 'paused';
        d.id = 'pauseOver';
        d.innerHTML = '<h2>ì¼ì‹œì •ì§€</h2>';
        document.body.appendChild(d);
        bgm.pause();
    } else {
        const d = document.getElementById('pauseOver');
        if(d) d.remove();
        input.focus();
        if(!state.muted) {
            bgm.play().catch(e => {});
        }
    }
}

els.startBtn.onclick = startGame;
els.pauseBtn.onclick = pause;
els.restartBtn.onclick = () => location.reload();
els.muteBtn.onclick = () => {
    state.muted = !state.muted;
    els.muteBtn.textContent = state.muted ? 'ìŒì†Œê±° í•´ì œ' : 'ìŒì†Œê±°';
    if(state.muted) {
        bgm.pause();
    } else if(state.started && !state.paused) {
        bgm.play().catch(e => {});
    }
};

input.addEventListener('keydown', e => {
    if(e.key === 'Enter') handleEnter();
});

document.addEventListener('click', () => {
    if(!state.over && !state.paused && state.started) input.focus();
});

canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;
requestAnimationFrame(loop);
    </script>
</body>
</html>
